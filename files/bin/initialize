#!/usr/bin/env bash
# Initialize backend and frontend - farmerconnect

BACKEND=~/backend
FRONTEND=~/frontend

# open editor session
tmux new-session -d -s editor -n nvim -c $FRONTEND
tmux send-keys -t editor:nvim 'nvim' C-m
echo "> editor session started"

# start hub client
tmux new-session -d -s hub -n client -c $FRONTEND
tmux send-keys -t hub:client 'yarn start:hub' C-m
echo "> hub session started"

# start api
tmux new-session -d -s backend -n api -c $BACKEND/src/FarmerConnect.Api
tmux send-keys -t backend:api 'dotnet watch run .' C-m
echo "> api session started"

# start database services
tmux new-window -t backend -n compose -c $BACKEND
tmux send-keys -t backend:compose 'docker-compose up' C-m
echo "> database services window created in api session"

# wait until database services are up to run migration scripts
tmux new-window -t backend -n migrations -c $BACKEND
sleep 40
tmux send-keys -t backend:migrations './updateAllDatabases.sh' C-m
echo "> migrations started in api session"


