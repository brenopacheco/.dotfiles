#!/usr/bin/env bash


RESULT=$(tmux list-sessions -F '#{session_name}: #{window_name} (#{window_index}) - #{window_id}' |\
    fzf --reverse --header "Switch session" \
    --preview 'tmux capture-pane -pt $(echo {} | sed "s/^\(\S\+\):.*/\1/"):$(echo {} | sed "s/.*(\([0-9]\+\))/\1/")')

if [[ -z "$RESULT" ]]; then 
    exit 0
fi

SESSION=$(echo "$RESULT" | sed "s/^\(\S\+\):.*/\1/")
WINDOW=$(echo "$RESULT" | sed "s/.*(\([0-9]\+\))/\1/")
ID=$RANDOM

tmux new -d -s tmp-$ID -t $SESSION \; select-window -t $WINDOW

if [[ -z "$TMUX" ]]; then
    tmux attach -t tmp-$ID:$WINDOW
else
    tmux switch-client -t tmp-$ID:$WINDOW
fi

# vim:tw=78:ts=8:noet:ft=sh:norl:
