#!/usr/bin/env bash
# Initialize backend and frontend - farmerconnect

BACKEND=~/horizon/backend
APP=~/horizon/Horizon65App

# configure database
tmux new-session -d -s docker -n lazydocker -c $BACKEND
tmux send-keys -t docker:lazydocker 'docker run --name dashboard -d -e PGADMIN_DEFAULT_EMAIL=user@mail.com -e PGADMIN_DEFAULT_PASSWORD=admin -p 3000:80 dpage/pgadmin4' C-m
tmux send-keys -t docker:lazydocker 'docker run --name db -d -e POSTGRES_DB=h65_backend_development -e POSTGRES_PASSWORD=postgres -p 5432:5432 postgres' C-m
tmux send-keys -t docker:lazydocker 'docker start  `docker ps -a -q`' C-m
tmux send-keys -t docker:lazydocker 'sleep 10' C-m
# tmux send-keys -t docker:lazydocker 'PGPASSWORD=postgres psql -d h65_backend_development -h localhost -p 5432 -c -U postgres -f ~/notes/dump.sql' C-m
tmux send-keys -t docker:lazydocker 'lazydocker' C-m

# start ngrok
tmux new-session -d -s ngrok -n ngrok -c $BACKEND
tmux send-keys -t ngrok:ngrok 'ngrok http 4000' C-m
sleep 3

# start server
tmux new-session -d -s backend -n mix -c $BACKEND
tmux send-keys -t backend:mix 'sleep 10' C-m
tmux send-keys -t backend:mix 'MIX_ENV=dev iex -S mix phx.server' C-m

# start app
tmux new-session -d -s app -n app -c $APP
tmux send-keys -t app:app 'npx expo start -c' C-m

# open editor
tmux new-session -d -s editor -n nvim -c $APP
tmux send-keys -t editor:nvim 'nvim' C-m
tmux send-keys -t editor:nvim Space n

echo "All done"
